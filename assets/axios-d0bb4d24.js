import{a as m}from"./axios-a342f982.js";import{bO as d,r as n,H as f}from"./index-bf168c3d.js";const p={USER:0,ADMIN:1},g=d("user",()=>{const{apiAuth:e}=b(),s=n(""),r=n(""),o=n(""),c=n(""),i=n(""),l=n(0),u=n(p.USER),h=t=>{t.token&&(o.value=t.token),s.value=t._id,r.value=t.name,c.value=t.account,i.value=t.email,l.value=t.cart,u.value=t.role},k=f(()=>o.value.length>0),A=f(()=>u.value===p.ADMIN),U=async()=>{if(o.value.length!==0)try{const{data:t}=await e.get("/users/me");h(t.result)}catch{v()}},v=()=>{o.value="",s.value="",c.value="",i.value="",l.value=0,u.value=p.USER};return{_id:s,name:r,token:o,account:c,email:i,cart:l,role:u,login:h,logout:v,isLogin:k,isAdmin:A,getProfile:U}},{persist:{key:"20240126",paths:["token"]}}),R=m.create({baseURL:"https://finalproject-back-emoshou.onrender.com"}),a=m.create({baseURL:"https://finalproject-back-emoshou.onrender.com"});a.interceptors.request.use(e=>{const s=g();return e.headers.Authorization="Bearer "+s.token,e});a.interceptors.response.use(e=>e,e=>{if(e.response&&e.response.data.message==="JWT 過期"&&e.config.url!=="/users/extend"){const s=g();return a.patch("/users/extend").then(({data:r})=>(s.token=r.result,e.config.headers.Authorization="Bearer "+s.token,m(e.config))).catch(()=>(s.logout(),Promise.reject(e)))}return Promise.reject(e)});const b=()=>({api:R,apiAuth:a});export{b as a,g as u};
